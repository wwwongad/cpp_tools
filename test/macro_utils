#ifndef MACRO_UTILS_H
#define MACRO_UTILS_H

// constexpr-aware assertion methods
#ifdef TEST_TARGET_IS_CONSTEXPR

#ifndef UL_TEST_CONSTEXPR
#define UL_TEST_CONSTEXPR constexpr
#endif

#ifndef UL_ASSERT
#define UL_ASSERT(x) static_assert(x)
#endif

#ifndef EXPECT_EQ
#define EXPECT_EQ(expected, actual) static_assert((expected) == (actual), "EXPECT_EQ failed")
#endif

#ifndef EXPECT_NE
#define EXPECT_NE(expected, actual) static_assert((expected) != (actual), "EXPECT_NE failed")
#endif

#ifndef EXPECT_LT
#define EXPECT_LT(expected, actual) static_assert((expected) < (actual), "EXPECT_LT failed")
#endif

#ifndef EXPECT_LE
#define EXPECT_LE(expected, actual) static_assert((expected) <= (actual), "EXPECT_LE failed")
#endif

#ifndef EXPECT_GT
#define EXPECT_GT(expected, actual) static_assert((expected) > (actual), "EXPECT_GT failed")
#endif

#ifndef EXPECT_GE
#define EXPECT_GE(expected, actual) static_assert((expected) >= (actual), "EXPECT_GE failed")
#endif

#else // Non-constexpr case

#ifndef UL_TEST_CONSTEXPR
#define UL_TEST_CONSTEXPR
#endif

#ifndef UL_ASSERT
#include <cassert>
#define UL_ASSERT(x) assert(x)
#endif

#ifndef EXPECT_EQ
#define EXPECT_EQ(expected, actual) assert((expected) == (actual))
#endif

#ifndef EXPECT_NE
#define EXPECT_NE(expected, actual) assert((expected) != (actual))
#endif

#ifndef EXPECT_LT
#define EXPECT_LT(expected, actual) assert((expected) < (actual))
#endif

#ifndef EXPECT_LE
#define EXPECT_LE(expected, actual) assert((expected) <= (actual))
#endif

#ifndef EXPECT_GT
#define EXPECT_GT(expected, actual) assert((expected) > (actual))
#endif

#ifndef EXPECT_GE
#define EXPECT_GE(expected, actual) assert((expected) >= (actual))
#endif

#endif // #ifndef TEST_TARGET_IS_CONSTEXPR

// Methods based on defined macros or non-constexpr aware
#ifndef EXPECT_TRUE
#define EXPECT_TRUE(x) UL_ASSERT(x)
#endif

#ifndef EXPECT_FALSE
#define EXPECT_FALSE(x) UL_ASSERT(!(x))
#endif

#ifndef EXPECT_SAME_TYPE
#include <concepts>
#define EXPECT_SAME_TYPE(type1, type2) \
    static_assert(std::same_as<type1, type2>, "EXPECT_SAME_TYPE failed");
#endif

#ifndef EXPECT_VALUES_SAME_TYPE
#include <concepts>
#define EXPECT_VALUES_SAME_TYPE(value1, value2)\
    static_assert(std::same_as<decltype((value1)), decltype((value2))>, "EXPECT_VALUES_SAME_TYPE failed");
#endif

#ifndef EXPECT_VALUES_DIFF_TYPE
#include <concepts>
#define EXPECT_VALUES_DIFF_TYPE(value1, value2)\
static_assert(!std::same_as<decltype((value1)), decltype((value2))>, "EXPECT_VALUES_DIFF_TYPE failed");
#endif

#ifndef EXPECT_OF_TYPE
#include <concepts>
#define EXPECT_OF_TYPE(value, type) \
    static_assert(std::same_as<decltype((value)), type>, "EXPECT_OF_TYPE failed");
#endif

#ifndef EXPECT_CONVERTIBLE
#include <concepts>
#define EXPECT_CONVERTIBLE(type1, type2)\
    static_assert(std::convertible_to<type1, type2>, "EXPECT_CONVERTIBLE failed");
#endif

#ifndef EXPECT_THROW
#define EXPECT_THROW(expr, exception_type) \
    try { expr; UL_ASSERT(false); } catch (const exception_type&) { }
#endif

#ifndef EXPECT_NO_THROW
#define EXPECT_NO_THROW(expr) \
    try { expr; } catch (...) { UL_ASSERT(false); }
#endif


#endif //MACRO_UTILS_H
